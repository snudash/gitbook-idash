# 리눅스 네트워크

컴퓨터 하드웨어의 구성요소이자 운영체제가 다루어야할 기본 요소로 중앙처리장치\(CPU\), 기억장치\(메모리\), 저장장치\(디스크\), 입출력장치\(키보드와 모니터\)를 꼽습니다. 이것을 갖추면 컴퓨터가 된다는 것입니다. 리눅스는 1991년 처음 공개되었는데 WWW \(World Wide Web\)이 처음 만들어진 것은 1989년이었죠. 리눅스는 시대에 맞추어 4가지 기본 요소에 더해 네트워크를 운영체제의 기본요소로 도입하였습니다. 인터넷 시대가 본격적으로 시작되면서 네트워크를 운영체제가 기본적으로 지원하는 리눅스가 각광을 받을 수밖에 없었습니다. 리눅스는 일반 개인이 많이 사용하지는 않지만 웹 서비스에서는 매우 큰 지분을 차지하고 있습니다. 또 스마트폰의 시대가 시작되며 리눅스는 안드로이드\(Android\)라는 운영체제로 영역을 넓혔가고 있습니다. 웹이나 스마트폰처럼 네트워크가 필수적인 곳에서 리눅스는 그 역할을 해왔습니다. 이제 사실 네트워크에 연결되지 않은 컴퓨터로 할 수 있는 일이 별로 없는 시대가 되었습니다. 네트워크가 컴퓨터의 기본 요소로 확실하게 자리를 잡은 것입니다.

## 파일 시스템 권한

네트워크를 이야기하기 전에 할 이야기가 있습니다. 한 컴퓨터를 여러 사람이 쓸 수 있고 동시에 쓸 수 있을 때 생기는 문제입니다. 인터넷 시대 이전에 이미 이런 기능은 있었습니다. 유닉스\(Unix\) 운영체제는 1969년 처음 공개된 것으로 다중사용자\(multiuser\)와 다중작업\(multitasking\)을 지원하는 운영체제입니다. 컴퓨터라는 기계가 한 개인 소유할 수는 없는 수준의 물건이었다는 점에서 다중사용자 다중작업은 어쩌면 당연히 컴퓨터가 갖추어야 할 기능이었을 겁니다. 개인용 컴퓨터에 설치하기 위해 만들어진 Microsoft Windows는 이런 기능을 전혀 갖추지 못하고 있었습니다. 여러사람이 동시에 하나의 컴퓨터를 이용하는데 누구나 아무 파일나 마음대로 만들고 지우고 고칠 수 있다면 어떤 일이 벌어지겠습니까? 이런 혼란을 막기 위해 파일 시스템에 접근 제어 목록\(ACL, Access Control List\)이라는 기능이 사용됩니다. 어떤 파일에 대해 누가 어떤 권한을 가지고 있는 명시하여 사용자의 파일 사용을 통제하는 것입니다.

* [Unix file system permission](https://www.tutorialspoint.com/unix/unix-file-permission.htm)

그리고 시스템을 관리하기 위해서는 전권을 가질 필요가 있습니다. 무엇이든지 할 수 있는 권한을 가진 사용자를 superuser라고 합니다. 새로운 사용자를 등록하거나 새로운 패키지를 설치하거나 시스템 자체를 삭제해 버릴 수 있는 권한까지 가지고 있는 사용자입니다. 여기서 '사용자'란 물론 컴퓨터 로그인 계정을 말하는 것이지 진짜 사람을 의미하는 것이 아닙니다.

* [슈퍼유저](https://ko.wikipedia.org/wiki/%EC%8A%88%ED%8D%BC%EC%9C%A0%EC%A0%80)

슈퍼유저 계정은 리눅스에서는 보통 `root`라는 이름으로 만들어지는 것이 일반적입니다. 윈도우에서 '관리자'도 이것에 해당합니다. 시스템 관리를 하려고 할 때 슈퍼유저 권한이 필요한데 그렇다고 해서 `root` 계정으로 로그인해서 작업을 하는 것은 아닙니다. 보통은 `sudo`를 이용하여 필요한 경우에만 관리자 수준의 명령을 실행합니다.

* [sudo](https://ko.wikipedia.org/wiki/Sudo)

## SSH

여러분 노트북에 리눅스를 직접 설치했거나 가상머신에 설치했다면 리눅스를 부팅해서 터미널 앱을 열면 셸 명령을 내릴 수 있습니다. macOS에서도 Terminal.app을 열어 셸을 사용하면 됩니다. MS Windows의 경우에 WSL, Cygwin, GitBash 등이 설치되었다면 역시 각각의 터미널 프로그램을 열어 셸을 사용할 수 있습니다.

구글 클라우드에 만든 Compute Engine 가상머신처럼 컴퓨터가 여러분 앞에 있는 것이 아니라면 원격으로 접속해야 합니다. 구글 클라우드 웹 페이지의 VM 목록에서 SSH 버튼을 클릭하여 접속하는 것은 이미 해 보았습니다. SSH는 Secure Shell의 약자입니다. 보안이 있는 셸이라는 뜻입니다. SSH는 23번 포트로 접속하여 원격 컴퓨터에 있는 셸을 사용할 수 있게 해 줍니다. 보안되지 않은 네트워크에서 암호화된 통신을 통해 원격 컴퓨터에 로그인하여 명령을 내릴 수 있게 해 줍니다. SFTP P \(SSH File Transfer Protocol\)는 파일을 전송할 수 있게 해줍니다. SSH, SFTP, 포트 등에 대해 알고 싶다면 다음을 참조해 보세요.

* [SSH](https://ko.wikipedia.org/wiki/시큐어_셸)
* [SFTP](https://ko.wikipedia.org/wiki/SSH_파일_전송_프로토콜)
* [패킷](https://ko.khanacademy.org/computing/computer-science/internet-intro/internet-works-intro/v/the-internet-packet-routers-and-reliability) \(at Khan Academy\)
* [네트워크 포트](https://opentutorials.org/course/2598/14470) \(at [opentutorials.org](https://www.opentutorials.org/)\)

여기에서는 구글 클라우드 웹 페이지를 통하지 않고 SSH로 접속하는 방법을 알아보려고 합니다. 원격 컴퓨터 관리에 사용하는 SSH와과 파일 전송에 사용되는 SFT\)가 여러분 컴퓨터에 설치되어 있어야 합니다. Linux, macOS 또는 WSL, Cygwin, GitBash 어느 것을 사용하든 터미널을 열고 `ssh` 명령과 `sftp` 명령을 내려보십시오.

```bash
$ ssh
```

그런 명령이 없다는 메시지가 나오면 설치해야 합니다. Linux, WSL에서는 패키지 관리자를 이용해 설치하세요. Cygwin에도 기본으로는 설치가 안 되어 있을 수도 있습니다. 설치가 되어 있다면 접속할 때는 원격 컴퓨터의 주소와 로그인하려는 계정 아이디를 명시하면 됩니다. 예를 들어, 아이피가 `192.168.0.2`이고 계정이름이 `myname`이라면 다음과 같이 명령을 내립니다.

```bash
$ ssh myname@192.168.0.2
```

여기서 IP 주소 부분에는 여러분의 구글 클라우드 VM 목록에서 외부 IP \(External IP\)를 지정하면 됩니다. 하지만 접속하려고 해보면 오류가 날 것입니다. 보안을 위해 SSH Key를 등록해서 사용하도록 하고 있기 때문입니다. 공개키 암호 시스템이라는 것을 이용합니다. 궁금하신 분들은 다음 사이트를 참조하세요.

* [암호화 및 공개키](https://ko.khanacademy.org/computing/computer-science/internet-intro/internet-works-intro/v/the-internet-encryption-and-public-keys) \(at Khan Academy\)
* [공개키 암호](http://www.parkjonghyuk.net/lecture/2012-1st-lecture/modernCrypto/chap05.pdf)

이런 개념을 잘 몰라도 우선 그냥 따라해 보도록 합시다. 공인인증서의 원리를 몰라도 인터넷 뱅킹들 잘 하시죠? 

###  SSH key-pair 생성하기

우선 여러분의 보안키를 생성해야 합니다. 이것은 공개키\(pulbic key\)와 개인키\(private key\) 두 가지로 구성되어 있습니다. 일반적으로 여러분의 홈 디렉토리 아래 `~/.ssh` 디렉토리에 저장해 놓고 사용합니다. 여러분이 접속하려는 로그인 계정의 이름이 `myname`이라면 다음과 같이 명령을 내리고 시키는 대로 암호 등을 입력하세요.

```bash
$ ssh-keygen -t ras -f ~/.ssh/my-ssh-key -C myname
```

이 명령이 성공적으로 실행되면 `~/.ssh` 디렉토리에 공개키 `my-ssh-key.pub`와 개인키 `my-ssh-ky` 파일이 생성됩니다. 개인키는 공인인증서 같은 것이니 분실되거나 노출되지 않도록 잘 보관해야 합니다. 공개키는 남에게 주어도 됩니다. 

참고로 여기서 RSA 공개키 암호 시스템은 큰 숫자를 소인수분해하기 어렵다는 점을 이용해 암호화하는 방법입니다. 공개키는 모두에게 공개하는 것이며 암호화\(암호로 만들기\)를 할 때 사용고 개인키는 비밀로 유지하고 복호화\(암호 풀기\)할 때 사용합니다. RSA 알고리즘은 개인키로 암호화하고 공개키로 복호화할 수도 있습니다.

### 공개키 클라우드에 등록하기

다음으로 공개키를 구글 클라우드에 등록을 해야 합니다.  특정 서버에 등록할 수도 있지만 그냥 자신의 클라우드에 등록해 봅시다. 다음 메뉴를 찾아가서 `my-ssh-key.pub` 파일의 내용을 복사해서 붙여넣고 저장하면 됩니다.

* Compute Engine &gt; Metadata &gt; Add Metadata &gt; SSH Keys

### 개인키 이용하여 접속하기

이제 접속할 때 다음과 같은 형식으로 명령을 내립니다.

```bash
$ ssh -i ~/.ssh/my-ssh-key myname@192.168.0.2
```

서버에 파일을 업로드하거나 서버에 있는 파일을 다운로드하고 싶을 때에는 `sftp` 명령을 이용하세요. 사용 방법은 동일합니다.

```bash
$ sftp -i ~/.ssh/my-ssh-key myname@192.168.0.2
```

접속 후 `help` 명령을 내리면 사용가능한 명령 목록을 보실 수 있습니다. 업로드는 `put`, 다운로드는 `get`을 이용하면 됩니다.

